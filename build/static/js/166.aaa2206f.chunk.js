(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[166],{1672:function(e,t,n){"use strict";n.r(t),n.d(t,"fetchData",(function(){return R})),n.d(t,"View",(function(){return K}));var a=n(10),c=n.n(a),r=n(622),s=n(29),i=n(15),u=n(19),o=n(1),l=n(0),j=n.n(l),b=n(155),d=n(1803),O=n(1792),p=n(618),f=n(602),m=n(99),h=n(1793),x=n(1733),g=n(1797),v=n(55),y=n(1673),N=n.n(y),I=n(738),k=n.n(I),q=n(181),S=n(9),w=n(22),C=n(183),_=n(733),P=n(720),A=n(698),Q=n(163),F=n(864),D=n(737),z=n(755),E=n(1007),J=n(684),L=n(734),B=n(37),G=n(109),T=S.a.serverPreference.pagination.userAuditLogs;function U(e){var t,n,a={actionQuery:(null===(t=e.actionQuery)||void 0===t?void 0:t.trim())?e.actionQuery.trim().substr(0,40):null,ip:(null===(n=e.ip)||void 0===n?void 0:n.trim())?e.ip.trim().substr(0,45):null,firstObjectId:Number.isSafeInteger(Number(e.firstObjectId))?Number(e.firstObjectId):null,secondObjectId:Number.isSafeInteger(Number(e.secondObjectId))?Number(e.secondObjectId):null,page:Number.isSafeInteger(Number(e.page))?Number(e.page):null};return Object.fromEntries(Object.entries(a).filter((function(e){var t=Object(u.a)(e,2);t[0];return null!=t[1]})))}function R(e,t){return H.apply(this,arguments)}function H(){return(H=Object(i.a)(c.a.mark((function e(t,n){var a,s,i,u,o,l,j,b;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=U(n),s=a.page||1,i={query:a,response:{}},e.t0=r.a,e.next=6,Promise.all([q.c.user.getUserMeta({username:t}),q.c.user.queryAuditLogs({username:t,actionQuery:a.actionQuery,ip:a.ip,firstObjectId:a.firstObjectId,secondObjectId:a.secondObjectId,skipCount:T*(s-1),takeCount:T,locale:S.a.locale})]);case 6:e.t1=e.sent,u=(0,e.t0)(e.t1),e.prev=8,u.s();case 10:if((o=u.n()).done){e.next=21;break}if(l=o.value,j=l.requestError,b=l.response,!j){e.next=16;break}throw new C.a(j,{showRefresh:!0,showBack:!0});case 16:if(!b.error){e.next=18;break}throw new C.a(Object(B.c)("user_edit.errors.".concat(b.error)));case 18:Object.assign(i.response,b);case 19:e.next=10;break;case 21:e.next=26;break;case 23:e.prev=23,e.t2=e.catch(8),u.e(e.t2);case 26:return e.prev=26,u.f(),e.finish(26);case 29:return e.abrupt("return",i);case 30:case"end":return e.stop()}}),e,null,[[8,23,26,29]])})))).apply(this,arguments)}var K=Object(v.a)((function(e){var t=Object(w.i)("user_edit.audit"),n=Object(w.k)();Object(l.useEffect)((function(){S.a.enterNewPage("".concat(t(".title")," - ").concat(e.response.meta.username),null,!1)}),[S.a.locale,e.response]);var a=Object(l.useState)(e.query.actionQuery),c=Object(u.a)(a,2),r=c[0],i=c[1],v=Object(l.useState)(e.query.ip),y=Object(u.a)(v,2),I=y[0],q=y[1],C=Object(l.useState)(null==e.query.firstObjectId?"":e.query.firstObjectId.toString()),B=Object(u.a)(C,2),U=B[0],R=B[1],H=Object(l.useState)(null==e.query.secondObjectId?"":e.query.secondObjectId.toString()),K=Object(u.a)(H,2),M=K[0],V=K[1];function W(e){var t={};return r&&(t.actionQuery=r),I&&(t.ip=I),""!==U&&(t.firstObjectId=Number(U)),""!==M&&(t.secondObjectId=Number(M)),{query:Object.fromEntries(Object.entries(Object(s.a)(Object(s.a)({},t),e)).map((function(e){var t=Object(u.a)(e,2);return[t[0],t[1].toString()]})))}}function X(e){n.navigate(W(e))}function Y(e,n,a,c){var r=function(t){return Object(o.jsx)(G.a,{children:Object(o.jsx)("div",{style:{display:"inline-block"},onClick:function(t){t.stopPropagation(),t.ctrlKey&&(t.preventDefault(),X(1===e?{firstObjectId:a}:{secondObjectId:a}))},children:t})})};if(!n)return null;if(!c)return r(Object(o.jsxs)(z.a,{children:["Deleted ",n," #",a]}));switch(n){case"User":var s=c;return r(Object(o.jsx)(P.a,{user:s}));case"Group":var i=c;return r(Object(o.jsx)(z.a,{children:i.name}));case"Problem":var l=c,j=Object(u.a)(l,2),d=j[0],O=j[1];return r(Object(o.jsx)(w.a,{href:Object(J.c)(d),children:Object(J.a)(d,O,t)}));case"ProblemTag":var p=c;return r(Object(o.jsx)(b.a,{size:"small",content:p.name,color:p.color,as:w.a,href:{pathname:"/p",query:{tagIds:p.id.toString()}}}));case"Submission":return r(Object(o.jsxs)(w.a,{href:"/s/".concat(a),children:["#",a]}));case"Discussion":var f=c;return r(Object(o.jsxs)(w.a,{href:Object(L.b)(f),children:["#",f.id," ",Object(L.a)(f.title,t)]}));case"DiscussionReply":return r(Object(o.jsxs)(z.a,{children:["#",a]}));default:return r(Object(o.jsxs)(z.a,{children:["Unknown ",n," #",a]}))}}return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(d.a,{className:k.a.sectionHeader,size:"large",content:t(".header")}),Object(o.jsx)(O.a,{className:k.a.queryForm,children:Object(o.jsxs)(O.a.Group,{inline:!0,className:k.a.autoFormGroup,children:[Object(o.jsxs)("div",{className:k.a.inputs,children:[Object(o.jsx)(O.a.Input,{className:k.a.inputActionQuery,icon:"settings",iconPosition:"left",placeholder:t(".query.action_query"),value:r,onChange:function(e,t){var n=t.value;return i(n)}}),Object(o.jsx)(O.a.Input,{className:k.a.inputIp,icon:"wifi",iconPosition:"left",placeholder:t(".query.ip"),value:I,onChange:function(e,t){var n=t.value;return q(n)}}),Object(o.jsx)(O.a.Input,{className:k.a.inputObjectId,icon:"hashtag",iconPosition:"left",placeholder:t(".query.first_object_id"),value:U,onChange:function(e,t){var n=t.value;return""===n?R(""):Number.isSafeInteger(Number(n))?R(n):null}}),Object(o.jsx)(O.a.Input,{className:k.a.inputObjectId,icon:"hashtag",iconPosition:"left",placeholder:t(".query.second_object_id"),value:M,onChange:function(e,t){var n=t.value;return""===n?V(""):Number.isSafeInteger(Number(n))?V(n):null}})]}),Object(o.jsx)(p.a,{className:"labeled icon "+k.a.filterButton,icon:"search",content:t(".query.filter"),onClick:function(){return X()}})]})}),0===e.response.results.length?Object(o.jsx)(f.a,{placeholder:!0,children:Object.values(e.query).some((function(e){return e}))?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(d.a,{icon:!0,children:[Object(o.jsx)(m.a,{name:"search"}),t(".no_matched_audit_log")]}),Object(o.jsx)(f.a.Inline,{children:Object(o.jsx)(p.a,{primary:!0,onClick:function(){return n.goBack()},children:t(".goback")})})]}):Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{icon:!0,children:[Object(o.jsx)(m.a,{name:"list alternate"}),t(".no_audit_log")]})})}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(h.a.Group,{className:k.a.auditLogs,children:e.response.results.map((function(e,n){return Object(o.jsxs)(j.a.Fragment,{children:[0!==n&&Object(o.jsx)(x.a,{}),Object(o.jsxs)(h.a,{className:k.a.logItem,children:[Object(o.jsx)("div",{className:"avatar",children:Object(o.jsx)(_.a,{userAvatar:e.user.avatar,imageSize:70})}),Object(o.jsxs)(h.a.Content,{children:[Object(o.jsxs)(h.a.Author,{children:[Object(o.jsx)("span",{className:k.a.user,children:Object(o.jsx)(P.a,{user:e.user})}),Object(o.jsx)("span",{className:k.a.action,children:Object(o.jsx)(w.a,{href:W({actionQuery:e.action}),children:e.action})})]}),Object(o.jsx)(h.a.Text,{children:function(){var n=N()(t("user_audit.".concat(e.action)),/\[(.+?)\]/g,(function(t,n){switch(n){case"firstObject":return Y(1,e.firstObjectType,e.firstObjectId,e.firstObject);case"secondObject":return Y(2,e.secondObjectType,e.secondObjectId,e.secondObject);default:return null}})).map((function(e,t){return Object(o.jsx)(j.a.Fragment,{children:e},t)}));return e.details&&Object.keys(e.details)?Object(o.jsx)(g.a,{panels:[{key:"",title:{className:k.a.message,content:Object(o.jsx)("span",{children:n})},content:{content:Object(o.jsx)(A.b,{segmentClassName:k.a.codeboxSegment+" "+k.a.scrollableCodeBoxSegment,code:JSON.stringify(e.details,null,2),language:"json",children:Object(o.jsx)("div",{className:k.a.copyDetailsJson,title:t(".copy_details"),onClick:function(){return Object(E.a)(JSON.stringify(e.details,null,2))},children:Object(o.jsx)(m.a,{name:"copy"})})})}}]}):Object(o.jsx)("div",{className:k.a.message,children:n})}()}),Object(o.jsxs)(h.a.Actions,{className:k.a.info,children:[Object(o.jsx)(h.a.Action,{as:w.a,className:k.a.item,href:W({ip:e.ip}),children:e.ip}),e.ipLocation&&Object(o.jsx)(h.a.Action,{className:k.a.item,as:"span",children:Object(F.a)(e.ipLocation)}),Object(o.jsx)(h.a.Action,{className:k.a.item,as:"span",children:Object(Q.a)(e.time)[1]})]})]})]})]},n)}))}),e.response.count<=T?null:Object(o.jsx)("div",{className:k.a.pagination,children:Object(o.jsx)(D.a,{totalCount:e.response.count,currentPage:e.query.page||1,itemsPerPage:T,pageUrl:function(t){return{query:Object.fromEntries(Object.entries(Object(s.a)(Object(s.a)({},e.query),{},{page:t})).map((function(e){var t=Object(u.a)(e,2);return[t[0],t[1].toString()]})))}}})})]})]})}))}}]);
//# sourceMappingURL=166.aaa2206f.chunk.js.map