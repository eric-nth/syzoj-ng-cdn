(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[141],{1702:function(e,r,n){"use strict";n.r(r);var t=n(10),s=n.n(t),a=n(80),c=n(622),i=n(15),u=n(19),o=n(1),l=n(0),j=n(1803),b=n(99),d=n(1795),m=n(614),p=n(1790),h=n(618),O=n(55),f=n(758),x=n.n(f),v=n(1563),g=n.n(v),w=n(22),k=n(181),S=n(182),N=n(597),y=n(1564),P=n.n(y),C=function(e){var r=Object(l.useState)([]),n=Object(u.a)(r,2),t=n[0],a=n[1],c=Object(l.useState)(!1),j=Object(u.a)(c,2),b=j[0],d=j[1],p=Object(l.useState)(!1),h=Object(u.a)(p,2),O=h[0],f=h[1],x=Object(l.useRef)(""),v=Object(N.a)(function(){var r=Object(i.a)(s.a.mark((function r(n){var t;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=n.trim(),f(!0),x.current=n,n){r.next=6;break}return f(!1),r.abrupt("return");case 6:return r.next=8,e.onSearch(n);case 8:if(t=r.sent,x.current===n){r.next=11;break}return r.abrupt("return");case 11:a(t||[]),t&&0!==t.length||d(!0),f(!1);case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),500).callback;return Object(o.jsx)(m.a,{className:P.a.dropdown,placeholder:e.placeholder,fluid:!0,value:null,onSearchChange:function(e,r){var n=r.searchQuery;f(!0),d(!1),v(n)},search:function(e,r){return t.map((function(e,r){var n=e.key,t=e.content;return{key:n,value:r,text:Object(o.jsx)("div",{className:P.a.resultItem,children:t})}}))},onChange:function(r,n){var s,c=n.value;return s=c,e.onSelect(t[s].data),void a([])},noResultsMessage:b?e.noResultMessage:null,loading:O})},R=n(733),_=function(e){var r=Object(w.i)("components.permission_manager"),n=Number(Object.keys(e.permissionsLevelDetails)[0]),t=Object(w.d)(),O=Object(u.a)(t,2),f=O[0],v=O[1],N=Object(l.useState)(!1),y=Object(u.a)(N,2),P=y[0],_=y[1],L=Object(l.useState)(null),I=Object(u.a)(L,2),D=I[0],A=I[1],F=Object(w.m)(0,768);function M(e){return G.apply(this,arguments)}function G(){return(G=Object(i.a)(s.a.mark((function e(n){var t,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.c.user.searchUser({query:n,wildcard:"End"});case 2:if(t=e.sent,a=t.requestError,c=t.response,!a){e.next=9;break}S.a.error(a(r)),e.next=10;break;case 9:return e.abrupt("return",c.userMetas.map((function(e){return{key:e.id,data:e,content:F?Object(o.jsxs)("div",{className:g.a.userResultContainer,children:[Object(o.jsxs)(j.a,{as:"h4",image:!0,className:g.a.userResult+" "+g.a.firstRow,children:[Object(o.jsx)(R.a,{className:g.a.userResult+" "+g.a.avatar,userAvatar:e.avatar,imageSize:27.5,rounded:!0}),Object(o.jsx)("div",{className:g.a.userResult+" "+g.a.username,children:e.username})]}),e.email&&Object(o.jsx)("div",{className:g.a.userResult+" "+g.a.email,children:e.email})]}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R.a,{className:g.a.userResult+" "+g.a.avatar,userAvatar:e.avatar,imageSize:27.5,rounded:!0}),Object(o.jsx)("div",{className:g.a.userResult+" "+g.a.username,children:e.username}),e.email&&Object(o.jsx)("div",{children:e.email})]})}})));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(s.a.mark((function e(n){var t,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.c.group.searchGroup({query:n,wildcard:"End"});case 2:if(t=e.sent,a=t.requestError,c=t.response,!a){e.next=9;break}S.a.error(a(r)),e.next=10;break;case 9:return e.abrupt("return",c.groupMetas.map((function(e){return{key:e.id,data:e,content:Object(o.jsxs)("div",{className:g.a.groupName,children:[Object(o.jsx)(b.a,{className:g.a.groupIcon,name:"group"}),e.name]})}})));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){v(!1),_(!1),Q.close()}var H=Object(w.b)(Object(i.a)(s.a.mark((function n(){var t;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.onSubmitPermissions(D.userPermissions.map((function(e){var r=e.user,n=e.permissionLevel;return{userId:r.id,permissionLevel:n}})),D.groupPermissions.map((function(e){var r=e.group,n=e.permissionLevel;return{groupId:r.id,permissionLevel:n}})));case 2:!0===(t=n.sent)?E():t.error&&S.a.error(r(".submit_error.".concat(t.error),t.errorObjectId?{id:t.errorObjectId.toString()}:null));case 4:case"end":return n.stop()}}),n)})))),q=Object(u.a)(H,2),B=q[0],J=q[1],U=function(e){return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(d.a.Cell,{width:F?8:4,className:g.a.columnUsername,children:[Object(o.jsxs)(j.a,{as:"h4",image:!0,children:[Object(o.jsx)(R.a,{className:g.a.avatar,userAvatar:e.avatar,imageSize:27.5,rounded:!0}),Object(o.jsx)(j.a.Content,{children:e.username})]}),F&&e.email&&Object(o.jsx)("div",{className:g.a.emailInMobileView,children:e.email})]}),!F&&Object(o.jsx)(d.a.Cell,{width:6,children:e.email})]})},Q=Object(w.e)({},(function(){return Object(o.jsx)(j.a,{icon:"key",className:g.a.dialogHeader,content:Object(o.jsxs)(o.Fragment,{children:[r(".header"),!F&&Object(o.jsx)("div",{className:g.a.dialogHeaderInfo,children:e.objectDescription})]})})}),(function(){return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(j.a,{as:"h4",children:r(".permission_for_users")}),Object(o.jsxs)(d.a,{fixed:!0,unstackable:!0,children:[Object(o.jsxs)(d.a.Body,{children:[Object(o.jsxs)(d.a.Row,{children:[U(D.owner),Object(o.jsx)(d.a.Cell,{width:F?6:4,children:r(".owner")}),Object(o.jsx)(d.a.Cell,{width:2,textAlign:"right",children:Object(o.jsx)(b.a,{disabled:!0,name:"delete"})})]}),D.userPermissions.map((function(r,n){return Object(o.jsxs)(d.a.Row,{children:[U(r.user),Object(o.jsx)(d.a.Cell,{className:g.a.columnDropdown,children:Object(o.jsx)(m.a,{value:r.permissionLevel.toString(),options:Object.keys(e.permissionsLevelDetails).map((function(n){return{key:n,value:n,text:e.permissionsLevelDetails[n].title,disabled:!D.haveSubmitPermission&&Number(n)!==r.permissionLevel}})),onChange:function(e,r){var t=r.value;return function(e,r){v(!0),A(x()(D,{userPermissions:Object(a.a)({},e,{permissionLevel:{$set:r}})}))}(n,Number(t))}})}),Object(o.jsx)(d.a.Cell,{textAlign:"right",children:Object(o.jsx)(b.a,{name:"delete",disabled:!D.haveSubmitPermission,onClick:function(){return function(e){v(!0),A(x()(D,{userPermissions:{$splice:[[e,1]]}}))}(n)}})})]},r.user.id)}))]}),D.haveSubmitPermission&&Object(o.jsx)(d.a.Footer,{children:Object(o.jsx)(d.a.Row,{children:Object(o.jsx)(d.a.HeaderCell,{colSpan:4,className:g.a.columnDropdown,children:Object(o.jsx)(C,{placeholder:r(".search_users"),noResultMessage:r(".search_users_no_result"),onSearch:M,onSelect:function(e){return function(e){if(D.owner.id!==e.id){var r,t=Object(c.a)(D.userPermissions);try{for(t.s();!(r=t.n()).done;)if(r.value.user.id===e.id)return}catch(s){t.e(s)}finally{t.f()}v(!0),A(x()(D,{userPermissions:{$push:[{user:e,permissionLevel:n}]}}))}}(e)}})})})})]}),Object(o.jsx)(j.a,{as:"h4",children:r(".permission_for_groups")}),Object(o.jsxs)(d.a,{compact:!0,fixed:!0,unstackable:!0,children:[Object(o.jsx)(d.a.Body,{children:0===D.groupPermissions.length?Object(o.jsx)(d.a.Row,{children:Object(o.jsx)(d.a.HeaderCell,{colSpan:3,textAlign:"center",className:g.a.noGroupGranted,children:r(".no_group_granted")})}):D.groupPermissions.map((function(r,n){return Object(o.jsxs)(d.a.Row,{children:[Object(o.jsxs)(d.a.Cell,{className:g.a.columnGroupName,width:7,children:[Object(o.jsx)(b.a,{className:g.a.groupIcon,name:"group"}),r.group.name]}),Object(o.jsx)(d.a.Cell,{width:4,className:g.a.columnDropdown,children:Object(o.jsx)(m.a,{value:r.permissionLevel.toString(),options:Object.keys(e.permissionsLevelDetails).map((function(n){return{key:n,value:n,text:e.permissionsLevelDetails[n].title,disabled:!D.haveSubmitPermission&&Number(n)!==r.permissionLevel}})),onChange:function(e,r){var t=r.value;return function(e,r){v(!0),A(x()(D,{groupPermissions:Object(a.a)({},e,{permissionLevel:{$set:r}})}))}(n,Number(t))}})}),Object(o.jsx)(d.a.Cell,{width:5,textAlign:"right",children:Object(o.jsx)(b.a,{name:"delete",disabled:!D.haveSubmitPermission,onClick:function(){return function(e){v(!0),A(x()(D,{groupPermissions:{$splice:[[e,1]]}}))}(n)}})})]},r.group.id)}))}),D.haveSubmitPermission&&Object(o.jsx)(d.a.Footer,{children:Object(o.jsx)(d.a.Row,{children:Object(o.jsx)(d.a.HeaderCell,{colSpan:3,className:g.a.columnDropdown,children:Object(o.jsx)(C,{placeholder:r(".search_groups"),noResultMessage:r(".search_groups_no_result"),onSearch:$,onSelect:function(e){return function(e){var r,t=Object(c.a)(D.groupPermissions);try{for(t.s();!(r=t.n()).done;)if(r.value.group.id===e.id)return}catch(s){t.e(s)}finally{t.f()}v(!0),A(x()(D,{groupPermissions:{$push:[{group:e,permissionLevel:n}]}}))}(e)}})})})})]})]})}),(function(){return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(p.a,{trigger:Object(o.jsx)(h.a,{content:r(".cancel"),disabled:B,onClick:function(){return!f&&E()}}),disabled:!f,content:Object(o.jsx)(h.a,{negative:!0,content:r(".confirm_cancel"),onClick:function(){return E()}}),on:"click",position:"top center"}),Object(o.jsx)(h.a,{positive:!0,content:D.haveSubmitPermission?r(".submit"):r(".no_submit_permission"),loading:B,disabled:!D.haveSubmitPermission,onClick:function(){return J()}})]})})),V=Object(l.useState)(!1),K=Object(u.a)(V,2),T=K[0],W=K[1];return Object(l.useEffect)((function(){var r=function(){var r=Object(i.a)(s.a.mark((function r(){var n;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!P&&!T){r.next=2;break}return r.abrupt("return");case 2:return W(!0),r.next=5,e.onGetInitialPermissions();case 5:if(n=r.sent,W(!1),n){r.next=9;break}return r.abrupt("return",!1);case 9:return _(!0),A(n),Q.open(),r.abrupt("return",!0);case 13:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();"function"===typeof e.refOpen?e.refOpen(r):e.refOpen.current=r}),[e.refOpen,e.onGetInitialPermissions,P,T,Q]),Q.element};_=Object(O.a)(_);r.default=_}}]);
//# sourceMappingURL=141.b31ece0b.chunk.js.map