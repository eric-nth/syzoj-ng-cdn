(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[70],{912:function(e,t,n){"use strict";n.r(t),n.d(t,"DiscussionEditor",(function(){return ne}));var r=n(80),s=n(622),i=n(179),c=n(10),a=n.n(c),o=n(19),u=n(29),l=n(15),d=n(1),p=n(0),b=n.n(p),j=n(1725),m=n(1803),f=n(618),O=n(614),h=n(1790),x=n(155),y=n(99),v=n(593),g=n(602),k=n(601),R=n(1792),N=n(1728),w=n(55),_=n(187),C=n(1087),I=n(1799),P=n(1102),D=n.n(P),S=n.p+"074a8b32bffa183dcb423d68f0ef4f46.svg",E=n(183),M=n(9),T=n(181),U=n(22),q=n(734),F=n(182),A=n(720),H=n(163),L=n(733),z=n(771),B=n(755),K=n(689),W=n(988),G=n(842),J=n(37),Q=n(109),V=n(927),X=n(112);function Y(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(l.a)(a.a.mark((function e(t){var n,r,s,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M.a.serverPreference.pagination,e.next=3,T.c.discussion.getDiscussionAndReplies({locale:M.a.locale,queryRepliesType:"HeadTail",discussionId:t,getDiscussion:!0,headTakeCount:n.discussionRepliesHead,tailTakeCount:n.discussionReplies-n.discussionRepliesHead});case 3:if(r=e.sent,s=r.requestError,i=r.response,!s){e.next=10;break}throw new E.a(s,{showRefresh:!0,showBack:!0});case 10:if(!i.error){e.next=12;break}throw new E.a(Object(J.c)("discussion.errors.".concat(i.error)));case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=b.a.memo((function(e){return Object(d.jsx)("div",Object(u.a)(Object(u.a)({},e),{},{className:D.a.emoji+(e.className?" "+e.className:""),dangerouslySetInnerHTML:{__html:_.a.parse(e.emoji,Object(Q.b)(!1))}}))})),ee=function(e){var t=Object(U.i)("discussion"),n=M.a.serverPreference.misc.discussionReactionAllowCustomEmojis,r=M.a.serverPreference.misc.discussionReactionEmojis,s=r.length,i=s%5==0?5:s%4==0?4:s%3==0?3:s%2==0?2:1,c=Math.floor(s/i),a=Array(c).fill(null).map((function(e,t){return Array(i).fill(null).map((function(e,n){return r[t*i+n]}))}));return Object(d.jsxs)("div",{className:D.a.emojiPicker,children:[Object(d.jsx)("div",{className:D.a.emojiGrid,children:a.map((function(t,n){return Object(d.jsx)("div",{className:D.a.emojiRow,children:t.map((function(t){return Object(d.jsx)($,{className:e.currentUserReactions.includes(t)&&D.a.selected,emoji:t,onClick:function(){return e.onSelectEmoji(t)}},t)}))},n)}))}),n&&Object(d.jsx)(j.a,{className:D.a.customEmoji,placeholder:t(".custom_emoji"),fluid:!0,onKeyPress:Object(K.a)((function(t){return e.onSelectEmoji(t.target.value.trim())}))})]})};ee=Object(w.a)(ee);var te=function(e){var t,n,r,s=Object(U.i)("discussion.item"),i=Object(U.m)(0,768),c=Object(U.m)(1210,1/0),a=Object.entries(e.reactions.count).filter((function(e){return Object(o.a)(e,2)[1]})).sort((function(e,t){var n=Object(o.a)(e,1)[0],r=Object(o.a)(t,1)[0];function s(e){var t=M.a.serverPreference.misc.discussionReactionEmojis.indexOf(e);return-1!==t?String.fromCodePoint(t):e}return s(n)<s(r)?-1:1})),u=Object(p.useState)([]),l=Object(o.a)(u,2),j=l[0],k=l[1];function R(t){j.includes(t)||(k(j.concat(t)),e.onReaction(t,!e.reactions.currentUserReactions.includes(t)).then((function(){k((function(e){return e.filter((function(e){return e!==t}))}))})))}var N=Object(U.b)(e.onSetPublic),w=Object(o.a)(N,2),_=(w[0],w[1]),C=Object(U.b)(e.onDelete),I=Object(o.a)(C,2),P=I[0],S=I[1],E=Object(p.useState)(!1),T=Object(o.a)(E,2),q=T[0],F=T[1],K=Object(p.useState)(!1),W=Object(o.a)(K,2),G=W[0],J=W[1],Q=Object(p.useState)(!1),X=Object(o.a)(Q,2),Y=X[0],Z=X[1],te=Object(p.useState)(!1),ne=Object(o.a)(te,2),re=ne[0],se=ne[1],ie=Object(U.e)({basic:!0},(function(){return Object(d.jsx)(d.Fragment,{children:Object(d.jsx)(m.a,{icon:"delete",content:s(".actions.confirm_delete_dialog_title")})})}),(function(){return s(".actions.confirm_delete_dialog_content")}),(function(){return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(f.a,{basic:!0,inverted:!0,negative:!0,content:s(".actions.confirm_delete_dialog_confirm"),loading:P,onClick:S}),Object(d.jsx)(f.a,{basic:!0,inverted:!0,content:s(".actions.confirm_delete_dialog_cancel"),disabled:P,onClick:function(){return ie.close()}})]})})),ce=Object(p.useState)(),ae=Object(o.a)(ce,2),oe=ae[0],ue=ae[1],le=[e.permission.includes("Modify")&&("string"===typeof e.onEnterEdit?Object(d.jsx)(O.a.Item,{icon:"edit",text:s(".actions.edit"),as:U.a,href:e.onEnterEdit}):Object(d.jsx)(O.a.Item,{icon:"edit",text:s(".actions.edit"),onClick:e.onEnterEdit})),"Reply"===e.type&&M.a.currentUser&&Object(d.jsx)(O.a.Item,{icon:"quote left",text:s(".actions.quote"),onClick:e.onQuote}),e.permission.includes("ManagePermission")&&Object(d.jsx)(O.a.Item,{icon:"key",text:s(".actions.permission_manage"),onClick:e.onManagePermission}),e.permission.includes("ManagePublicness")&&Object(d.jsx)(h.a,{trigger:Object(d.jsx)(O.a.Item,{icon:e.isPublic?"eye slash":"eye",text:e.isPublic?s(".actions.set_non_public"):s(".actions.set_public")}),content:Object(d.jsx)(f.a,{positive:!e.isPublic,content:e.isPublic?s(".actions.confirm_set_non_public"):s(".actions.confirm_set_public"),onClick:function(){Z(!1),_()}}),open:Y,onOpen:function(){return Z(!0)},onClose:function(){return Z(!1)},context:oe,on:"click",position:"top center"}),e.permission.includes("Delete")&&Object(d.jsx)(h.a,{trigger:Object(d.jsx)(O.a.Item,{className:D.a.delete,icon:"delete",text:s(".actions.delete"),onClick:"Discussion"===e.type?ie.open:void 0}),content:Object(d.jsx)(f.a,{negative:!0,content:s(".actions.confirm_delete"),onClick:function(){se(!1),S()}}),disabled:"Discussion"===e.type,open:re,onOpen:function(){return se(!0)},onClose:function(){return se(!1)},context:oe,on:"click",position:"top center"})].filter((function(e){return e})).map((function(e,t){return Object(d.jsx)(b.a.Fragment,{children:e},t)})),de=e.isPublic?e.publisher.id===(null===(t=e.discussion.problem)||void 0===t||null===(n=t.meta)||void 0===n?void 0:n.ownerId)?Object(d.jsx)(x.a,{className:D.a.label,content:s(".label.problem_owner"),basic:!0}):e.publisher.id===e.discussion.publisher.id&&"Reply"===e.type?Object(d.jsx)(x.a,{className:D.a.label,content:s(".label.discussion_publisher"),basic:!0}):null:Object(d.jsx)(x.a,{className:D.a.label,icon:"eye slash",color:"red",content:s(".label.nonpublic"),basic:!0});return Object(d.jsxs)("div",{className:D.a.item+("Discussion"===e.type?" "+D.a.discussion:"")+(e.publisher.id===(null===(r=M.a.currentUser)||void 0===r?void 0:r.id)?" "+D.a.currentUser:""),children:[ie.element,!i&&Object(d.jsx)("div",{className:D.a.avatar,children:Object(d.jsx)(A.a,{user:e.publisher,children:Object(d.jsx)(L.a,{imageSize:40,userAvatar:e.publisher.avatar})})}),Object(d.jsxs)("div",{className:D.a.bubble+(P?" "+D.a.pending:""),children:[Object(d.jsx)(m.a,{block:!0,attached:"top",className:D.a.header,children:Object(d.jsxs)("div",{className:D.a.headerContents,children:[Object(d.jsxs)("div",{className:D.a.left,children:[!i&&Object(d.jsx)("div",{className:D.a.triangle}),i&&Object(d.jsx)("div",{className:D.a.avatar,children:Object(d.jsx)(A.a,{user:e.publisher,children:Object(d.jsx)(L.a,{imageSize:20,userAvatar:e.publisher.avatar})})}),Object(d.jsx)("div",{className:D.a.username,children:Object(d.jsx)("span",{children:Object(d.jsx)(A.a,{user:e.publisher})})}),Object(d.jsxs)("span",{className:D.a.commentedOn,children:[s(".commented_on"),Object(d.jsx)(V.a,{time:e.publishTime}),e.editTime&&Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("span",{className:D.a.edited,title:Object(H.a)(e.editTime)[1],children:s(".edited")})})]}),de&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:D.a.labelDivider}),de]})]}),Object(d.jsxs)("div",{className:D.a.right,children:[M.a.currentUser&&Object(d.jsx)("div",{className:D.a.actionIcon+(q?" "+D.a.active:""),children:Object(d.jsx)(h.a,{className:D.a.emojiPickerPopup,trigger:Object(d.jsx)(y.a,{name:"smile outline"}),content:Object(d.jsx)(ee,{currentUserReactions:e.reactions.currentUserReactions,onSelectEmoji:function(e){R(e),F(!1)}}),open:q,onOpen:function(){return F(!0)},onClose:function(){return F(!1)},on:"click",position:c?"bottom center":"right center"})}),le.length>0&&Object(d.jsx)(v.a,{innerRef:ue,children:Object(d.jsx)(O.a,{direction:i?"left":"right",className:D.a.actionIcon+(G?" "+D.a.active:""),icon:"ellipsis horizontal",open:G,onOpen:function(){return!Y&&!re&&J(!0)},onClose:function(){return J(!1)},children:Object(d.jsx)(O.a.Menu,{children:le})})})]})]})}),Object(d.jsx)(g.a,{attached:!0,className:D.a.content,children:Object(d.jsx)(z.default,{content:e.content})}),a.length>0&&Object(d.jsx)(g.a,{attached:"bottom",className:D.a.emojiList,children:Object(d.jsx)("div",{className:D.a.emojiListWrapper,children:a.map((function(t){var n=Object(o.a)(t,2),r=n[0],s=n[1];return Object(d.jsxs)("div",{className:D.a.emojiItem+(e.reactions.currentUserReactions.includes(r)?" "+D.a.selected:"")+(M.a.currentUser?"":" "+D.a.disabled),onClick:function(){return R(r)},children:[Object(d.jsx)($,{emoji:r}),Object(d.jsx)(B.a,{className:D.a.link,children:s})]},r)}))})})]})]})};te=Object(w.a)(te);var ne=Object(w.a)((function(e,t){var n,r,s=Object(U.i)("discussion.edit"),i=Object(U.m)(0,768),c=Object(U.b)(Object(l.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.onSubmit){t.next=6;break}return t.next=3,e.onSubmit(e.content);case 3:(n=t.sent)&&Q(!1),"function"===typeof n&&n();case 6:case"end":return t.stop()}}),t)})))),u=Object(o.a)(c,2),b=u[0],O=u[1],x=Object(p.useState)(!1),y=Object(o.a)(x,2),w=y[0],_=y[1],I=Object(U.h)(),P=Object(o.a)(I,2),S=P[0],E=P[1],T="NewDiscussion"===e.type||"UpdateDiscussion"===e.type,q="UpdateDiscussion"===e.type||"UpdateReply"===e.type,F="NewDiscussion"===e.type||"NewReply"===e.type,H="RawEditor"===e.type,B=Object(U.d)(),W=Object(o.a)(B,2),G=W[0],J=W[1],Q=H?function(){}:J,V=0===e.content.length||T&&0===e.title.length,Y=e.noSubmitPermission||V;return Object(d.jsxs)("div",{ref:t,className:D.a.item+" "+D.a.edit+((null===(n=e.publisher)||void 0===n?void 0:n.id)===(null===(r=M.a.currentUser)||void 0===r?void 0:r.id)?" "+D.a.currentUser:"")+(F?" "+D.a.new:"")+(T?" "+D.a.discussion:"")+(H?" "+D.a.raw:"")+(e.className?" "+e.className:""),children:[!i&&!H&&Object(d.jsx)("div",{className:D.a.avatar,children:Object(d.jsx)(A.a,{user:e.publisher,children:Object(d.jsx)(L.a,{imageSize:40,userAvatar:e.publisher.avatar})})}),Object(d.jsxs)("div",{className:D.a.bubble+(S?" "+D.a.editorFocused:""),children:[Object(d.jsxs)(m.a,{block:!0,attached:"top",className:D.a.header,children:[!i&&!H&&Object(d.jsx)("div",{className:D.a.triangle}),T&&Object(d.jsx)(j.a,{className:D.a.title,placeholder:s(".placeholder.title"),value:e.title,onChange:function(t,n){var r=n.value;b||(Q(!0),e.onChangeTitle(r))}}),Object(d.jsx)("div",{className:D.a.headerContents,children:Object(d.jsxs)(k.a,{attached:"top",className:D.a.editTab,tabular:!0,children:[Object(d.jsx)(k.a.Item,{active:!w,onClick:function(){return _(!1)},children:s(".tabs.edit")}),Object(d.jsx)(k.a.Item,{active:w,onClick:function(){return _(!0)},children:s(".tabs.preview")})]})})]}),Object(d.jsxs)(g.a,{attached:!0,className:D.a.mainSegment,onKeyPress:Object(K.a)((function(e){return!Y&&e.ctrlKey&&O()}),!1),children:[Object(d.jsx)(R.a,{style:w?{display:"none"}:{},children:Object(d.jsx)(v.a,{innerRef:E,children:Object(d.jsx)(N.a,{as:C.a,className:D.a.editor+" "+Object(X.d)(),maxRows:999,placeholder:q?s(T?".placeholder.update_discussion":".placeholder.update_reply"):F?s(T?".placeholder.add_discussion":".placeholder.add_reply"):e.placeholder,value:e.content,onChange:function(t,n){var r=n.value;b||(Q(!0),e.onChangeContent(String(r)))}})})}),w&&Object(d.jsx)(d.Fragment,{children:Object(d.jsx)(z.default,{className:D.a.preview,content:e.content,noOverflowCutFix:!0})}),!H&&Object(d.jsx)("div",{className:D.a.actions,children:F?Object(d.jsx)(d.Fragment,{children:Object(d.jsx)(f.a,{positive:!0,content:s(T?".actions.add_discussion":".actions.add_reply"),onClick:O,disabled:Y,loading:b})}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(h.a,{trigger:Object(d.jsx)(f.a,{content:s(".actions.cancel"),onClick:function(){return!G&&e.onCancel()}}),content:Object(d.jsx)(f.a,{negative:!0,content:s(".actions.confirm_cancel"),onClick:function(){return Q(!1),e.onCancel()}}),disabled:!G,position:"bottom center",on:"click"}),Object(d.jsx)(f.a,{positive:!0,content:s(T?e.noSubmitPermission?".actions.update_discussion_no_submit_permission":".actions.update_discussion":".actions.update_reply"),onClick:O,loading:b,disabled:Y})]})})]})]})]})}),{forwardRef:!0}),re=function(e){var t,n,c=Object(U.i)("discussion"),u=Object(U.k)();Object(p.useEffect)((function(){M.a.enterNewPage("".concat(Object(q.a)(e.response.discussion.meta.title,c)," - ").concat(c(".title")),"discussion")}),[M.a.locale,e.response]),Object(p.useEffect)((function(){var e=document.createElement("style");return e.innerHTML=".".concat(D.a.loadMore,"::before { mask-image: url(").concat(S,"); -webkit-mask-image: url(").concat(S,"); }"),document.head.appendChild(e),function(){return document.head.removeChild(e)}}));var b=Object(U.l)(),j=Object(p.useState)(function(){var t=e.response.repliesHead.map((function(e){return{type:"Reply",reply:e}})),n=e.response.repliesTail.map((function(e){return{type:"Reply",reply:e}})),r=e.response.repliesTotalCount-t.length-n.length;return[].concat(Object(i.a)(t),Object(i.a)(r?[{type:"LoadMore",loadMore:{afterId:t[t.length-1].reply.id,beforeId:n[0].reply.id,count:r}}]:[]),Object(i.a)(n))}()),O=Object(o.a)(j,2),h=O[0],x=O[1];function y(e,t){x((function(n){return n.map((function(n){var r;return(null===(r=n.loadMore)||void 0===r?void 0:r.afterId)===e?Object.assign({},n,{loadMore:Object.assign({},n.loadMore,"function"===typeof t?t(n.loadMore):t)}):n}))}))}function v(){return(v=Object(l.a)(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loadMore.loading){e.next=2;break}return e.abrupt("return");case 2:return y(t.loadMore.afterId,{loading:!0}),e.next=5,T.c.discussion.getDiscussionAndReplies({locale:M.a.locale,queryRepliesType:"IdRange",discussionId:R.meta.id,afterId:t.loadMore.afterId,beforeId:t.loadMore.beforeId,idRangeTakeCount:Math.min(t.loadMore.count,M.a.serverPreference.pagination.discussionRepliesMore)});case 5:if(n=e.sent,r=n.requestError,i=n.response,!r){e.next=12;break}F.a.error(r(c)),e.next=18;break;case 12:if(!i.error){e.next=16;break}F.a.error(c(".errors.".concat(i.error))),e.next=18;break;case 16:return x((function(e){var n,r=[],c=Object(s.a)(e.keys());try{for(c.s();!(n=c.n()).done;){var a,o=n.value;if((null===(a=e[o].loadMore)||void 0===a?void 0:a.afterId)===t.loadMore.afterId){if(0!==i.repliesCountInRange){var u,l=Object(s.a)(i.repliesInRange);try{for(l.s();!(u=l.n()).done;){var d=u.value;r.push({type:"Reply",reply:d})}}catch(b){l.e(b)}finally{l.f()}var p=i.repliesInRange.length;i.repliesCountInRange>p&&r.push({type:"LoadMore",loadMore:{afterId:i.repliesInRange[p-1].id,beforeId:t.loadMore.beforeId,count:i.repliesCountInRange-p}})}}else r.push(e[o])}}catch(b){c.e(b)}finally{c.f()}return r})),e.abrupt("return");case 18:y(t.loadMore.afterId,{loading:!1});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=Object(p.useState)(e.response.discussion),k=Object(o.a)(g,2),R=k[0],N=k[1];function w(e){N((function(t){return Object.assign({},t,e(t))}))}function _(e,t){x((function(n){return n.map((function(n){return n.reply&&n.reply.id===e?Object.assign({},n,"function"===typeof t?t(n):t):n}))}))}function C(e,t){_(e,(function(e){return Object.assign({},e,{reply:Object.assign({},e.reply,"function"===typeof t?t(e.reply):t)})}))}function I(e,t,n,r){return P.apply(this,arguments)}function P(){return(P=Object(l.a)(a.a.mark((function e(t,n,s,i){var o,u,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M.a.currentUser){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,T.c.discussion.toggleReaction({type:t,id:n,emoji:s,reaction:i});case 4:o=e.sent,u=o.requestError,l=o.response,u?F.a.error(u(c)):l.error?F.a.error(c(".errors.".concat(l.error))):(d=function(e){return{count:Object.assign({},e.count,Object(r.a)({},s,(i?1:-1)+(Number(e.count[s])||0))),currentUserReactions:i?e.currentUserReactions.concat(s):e.currentUserReactions.filter((function(e){return e!==s}))}},"Discussion"===t?w((function(e){return{reactions:d(e.reactions)}})):C(n,(function(e){return{reactions:d(e.reactions)}})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,n){return A.apply(this,arguments)}function A(){return(A=Object(l.a)(a.a.mark((function e(t,n,s){var i,o,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,("Discussion"===t?T.c.discussion.setDiscussionPublic:T.c.discussion.setDiscussionReplyPublic)((i={},Object(r.a)(i,"Discussion"===t?"discussionId":"discussionReplyId",n),Object(r.a)(i,"isPublic",s),i));case 2:o=e.sent,u=o.requestError,l=o.response,u?F.a.error(u(c)):l.error?F.a.error(c(".errors.".concat(l.error))):"Discussion"===t?w((function(e){var t=e.meta;return{meta:Object.assign({},t,{isPublic:s})}})):C(n,{isPublic:s});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return L.apply(this,arguments)}function L(){return(L=Object(l.a)(a.a.mark((function e(t,n){var s,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,("Discussion"===t?T.c.discussion.deleteDiscussion:T.c.discussion.deleteDiscussionReply)(Object(r.a)({},"Discussion"===t?"discussionId":"discussionReplyId",n));case 2:s=e.sent,i=s.requestError,o=s.response,i?F.a.error(i(c)):o.error?F.a.error(c(".errors.".concat(o.error))):"Discussion"===t?u.navigate({pathname:"/d",query:R.problem?{problemId:String(R.problem.meta.id)}:null}):x((function(e){return e.filter((function(e){var t;return(null===(t=e.reply)||void 0===t?void 0:t.id)!==n}))}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=Object(p.useState)(""),K=Object(o.a)(z,2),J=K[0],V=K[1];function X(){return(X=Object(l.a)(a.a.mark((function e(t){var n,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.c.discussion.createDiscussionReply({discussionId:R.meta.id,content:t},b("CreateDiscussionReply"));case 2:if(n=e.sent,r=n.requestError,s=n.response,!r){e.next=9;break}F.a.error(r(c)),e.next=16;break;case 9:if(!s.error){e.next=13;break}F.a.error(c(".errors.".concat(s.error))),e.next=16;break;case 13:return x((function(e){return[].concat(Object(i.a)(e),[{type:"Reply",reply:s.reply}])})),V(""),e.abrupt("return",!0);case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return(Y=Object(l.a)(a.a.mark((function e(t,n){var r,s,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.c.discussion.updateDiscussionReply({discussionReplyId:t,content:n});case 2:if(r=e.sent,s=r.requestError,i=r.response,!s){e.next=9;break}F.a.error(s(c)),e.next=15;break;case 9:if(!i.error){e.next=13;break}F.a.error(c(".errors.".concat(i.error))),e.next=15;break;case 13:return _(t,(function(e){return{type:"Reply",reply:Object.assign({},e.reply,{content:n,editTime:i.editTime})}})),e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=Object(p.useRef)();var $=Object(p.useRef)(),ee=Object(d.jsx)(W.a,{objectDescription:c(".permission_manager_description",{id:R.meta.id}),permissionsLevelDetails:{1:{title:c(".permission_level.read")},2:{title:c(".permission_level.write")}},refOpen:$,onGetInitialPermissions:Object(l.a)(a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.c.discussion.getDiscussionPermissions({id:R.meta.id});case 2:if(t=e.sent,n=t.requestError,r=t.response,!n){e.next=9;break}F.a.error(n(c)),e.next=14;break;case 9:if(!r.error){e.next=13;break}F.a.error(c(".error.".concat(r.error))),e.next=14;break;case 13:return e.abrupt("return",{owner:R.publisher,userPermissions:r.permissions.userPermissions,groupPermissions:r.permissions.groupPermissions,haveSubmitPermission:r.haveManagePermissionsPermission});case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),onSubmitPermissions:function(){var e=Object(l.a)(a.a.mark((function e(t,n){var r,s,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.c.discussion.setDiscussionPermissions({discussionId:R.meta.id,userPermissions:t,groupPermissions:n});case 2:if(r=e.sent,s=r.requestError,i=r.response,!s){e.next=9;break}F.a.error(s(c)),e.next=15;break;case 9:if("NO_SUCH_DISCUSSION"!==i.error){e.next=13;break}F.a.error(c(".errors.NO_SUCH_DISCUSSION")),e.next=15;break;case 13:if(!i.error){e.next=15;break}return e.abrupt("return",i);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}),re=e.response.permissionCreateNewDiscussion&&Object(d.jsx)(f.a,{primary:!0,className:"labeled icon",icon:"plus",content:c(".add_discussion"),as:U.a,href:Object(G.getNewDiscussionUrl)(null===(t=R.problem)||void 0===t||null===(n=t.meta)||void 0===n?void 0:n.id)}),se=Object(U.m)(0,768);return Object(d.jsxs)(d.Fragment,{children:[ee,Object(G.getBreadcrumb)(R.problem,c),Object(d.jsxs)("div",{className:D.a.titleAndActions,children:[Object(d.jsxs)("div",{className:D.a.title,children:[Object(d.jsx)(Q.a,{children:Object(d.jsx)(m.a,{size:"large",content:Object(q.a)(R.meta.title,c)})}),Object(d.jsx)("span",{className:D.a.replyCount,children:c(0===R.meta.replyCount?".reply_count_0":1===R.meta.replyCount?".reply_count":".reply_count_s",{replyCount:R.meta.replyCount})})]}),!se&&Object(d.jsx)("div",{className:D.a.actions,children:re})]}),Object(d.jsxs)("div",{className:D.a.items+(se?" "+D.a.mobile:""),children:[Object(d.jsx)(te,{type:"Discussion",discussion:R,content:R.content,isPublic:R.meta.isPublic,reactions:R.reactions,publisher:R.publisher,publishTime:new Date(R.meta.publishTime),editTime:R.meta.editTime&&new Date(R.meta.editTime),permission:R.permissions,onReaction:function(){var e=Object(l.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("Discussion",R.meta.id,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),onSetPublic:function(){return E("Discussion",R.meta.id,!R.meta.isPublic)},onManagePermission:function(){return $.current&&$.current()},onEnterEdit:"/d/".concat(R.meta.id,"/edit"),onDelete:Object(l.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H("Discussion",R.meta.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}),h.map((function(e,t){return"EditReply"===e.type?Object(d.jsx)(ne,{publisher:e.reply.publisher,content:e.editReplyContent,type:"UpdateReply",onCancel:function(){_(e.reply.id,(function(){return{type:"Reply"}}))},onChangeContent:function(t){return _(e.reply.id,{editReplyContent:t})},onSubmit:function(t){return function(e,t){return Y.apply(this,arguments)}(e.reply.id,t)}},e.reply.id):"Reply"===e.type?Object(d.jsx)(te,{type:"Reply",discussion:R,content:e.reply.content,isPublic:e.reply.isPublic,reactions:e.reply.reactions,publisher:e.reply.publisher,publishTime:new Date(e.reply.publishTime),editTime:e.reply.editTime&&new Date(e.reply.editTime),permission:e.reply.permissions,onReaction:function(){var t=Object(l.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I("DiscussionReply",e.reply.id,n,r);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),onQuote:function(){return function(e,t){var n=J;n&&(n.endsWith("\n")&&(n=n.slice(0,-1)),n.endsWith("\n")&&(n=n.slice(0,-1)),n+="\n\n"),V(n+"> @".concat(e,":\n>\n")+t.trimEnd().split("\n").map((function(e){return"> ".concat(e).trimRight()})).join("\n")+"\n\n"),Z.current&&Z.current.scrollIntoView()}(e.reply.publisher.username,e.reply.content)},onSetPublic:function(){return E("DiscussionReply",e.reply.id,!e.reply.isPublic)},onEnterEdit:function(){_(e.reply.id,(function(e){return{type:"EditReply",editReplyContent:e.reply.content}}))},onDelete:Object(l.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H("DiscussionReply",e.reply.id);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))},e.reply.id):Object(d.jsx)("div",{className:D.a.loadMore,children:Object(d.jsxs)("div",{children:[c(1===e.loadMore.count?".load_more.hidden_count":".load_more.hidden_count_s",{count:e.loadMore.count}),Object(d.jsx)(B.a,{onClick:function(){return function(e){return v.apply(this,arguments)}(e)},children:c(".load_more.load_more")})]})},"LoadMore".concat(t))})),M.a.currentUser&&Object(d.jsxs)(d.Fragment,{children:[!se&&Object(d.jsx)("div",{className:D.a.dividerBeforeAddReply}),Object(d.jsx)(ne,{ref:Z,publisher:M.a.currentUser,content:J,type:"NewReply",onChangeContent:V,onSubmit:function(e){return X.apply(this,arguments)}})]})]})]})};re=Object(w.a)(re);t.default=Object(E.c)(function(){var e=Object(l.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Number(t.params.id)||0,e.next=3,Y(n);case 3:return r=e.sent,e.abrupt("return",Object(d.jsx)(re,{response:r},Object(I.a)()));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=70.8d2a2af5.chunk.js.map