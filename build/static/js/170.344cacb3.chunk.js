(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[170],{1669:function(e,s,t){"use strict";t.r(s),t.d(s,"fetchData",(function(){return L})),t.d(s,"View",(function(){return D}));var a=t(622),r=t(10),n=t.n(r),c=t(19),o=t(15),i=t(1),l=t(0),u=t(1803),j=t(1725),d=t(618),b=t(1790),m=t(242),O=t(602),p=t(155),f=t(99),v=t(55),x=t(1730),h=t(1670),w=t(1085),g=t(738),_=t.n(g),k=t(181),N=t(9),I=t(182),S=t(22),y=t(686),C=t(183),E=t(864),A=t(163),U=t(37);function L(e){return F.apply(this,arguments)}function F(){return(F=Object(o.a)(n.a.mark((function e(s){var t,r,c,o,i,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.t0=a.a,e.next=4,Promise.all([k.c.user.getUserSecuritySettings({username:s}),k.c.auth.listUserSessions({username:s})]);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),e.prev=6,r.s();case 8:if((c=r.n()).done){e.next=19;break}if(o=c.value,i=o.requestError,l=o.response,!i){e.next=14;break}throw new C.a(i,{showRefresh:!0,showBack:!0});case 14:if(!l.error){e.next=16;break}throw new C.a(Object(U.c)("user_edit.errors.".concat(l.error)));case 16:Object.assign(t,l);case 17:e.next=8;break;case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(6),r.e(e.t2);case 24:return e.prev=24,r.f(),e.finish(24);case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}}),e,null,[[6,21,24,27]])})))).apply(this,arguments)}var D=Object(v.a)((function(e){var s=Object(S.i)("user_edit.security");Object(l.useEffect)((function(){N.a.enterNewPage("".concat(s(".title")," - ").concat(e.meta.username),null,!1)}),[N.a.locale,e.meta]);var t=Object(S.l)(),a=N.a.currentUser.isAdmin||N.a.currentUserPrivileges.includes("ManageUser"),r=Object(l.useState)(""),v=Object(c.a)(r,2),g=v[0],C=v[1],U=Object(l.useState)(""),L=Object(c.a)(U,2),F=L[0],D=L[1],z=Object(l.useState)(""),P=Object(c.a)(z,2),T=P[0],W=P[1],M=Object(S.g)(g,(function(e){return!!e||!e&&!F})),V=Object(c.a)(M,2),q=V[0],B=V[1],R=Object(S.g)(F,(function(e){return Object(y.e)(e)||!e})),H=Object(c.a)(R,2),J=H[0],G=H[1],K=Object(S.g)(T,(function(e){return e===F||!e})),Q=Object(c.a)(K,2),X=Q[0],Y=Q[1],Z=Object(l.useState)(!1),$=Object(c.a)(Z,2),ee=$[0],se=$[1],te=Object(l.useState)(!1),ae=Object(c.a)(te,2),re=ae[0],ne=ae[1],ce=Object(l.useState)(!1),oe=Object(c.a)(ce,2),ie=oe[0],le=oe[1];function ue(){q(),J(),X()}var je=Object(S.b)(Object(o.a)(n.a.mark((function t(){var r,c,o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(B&&!a||G||Y)){t.next=3;break}t.next=17;break;case 3:if(F){t.next=7;break}ne(!0),t.next=17;break;case 7:if(T){t.next=11;break}le(!0),t.next=17;break;case 11:return t.next=13,k.c.user.updateUserPassword({userId:e.meta.id,oldPassword:g||null,password:F});case 13:r=t.sent,c=r.requestError,o=r.response,c?I.a.error(c(s)):"WRONG_OLD_PASSWORD"===o.error?se(!0):o.error?I.a.error(s("user_edit.errors.".concat(o.error))):(I.a.success(s(".password.success")),C(""),D(""),W(""),se(!1),ne(!1),le(!1));case 17:case"end":return t.stop()}}),t)})))),de=Object(c.a)(je,2),be=de[0],me=de[1],Oe=Object(l.useState)(e.meta.email),pe=Object(c.a)(Oe,2),fe=pe[0],ve=pe[1],xe=Object(S.g)(fe,(function(e){return Object(x.a)(e)})),he=Object(c.a)(xe,2),we=he[0],ge=he[1],_e=Object(l.useState)(""),ke=Object(c.a)(_e,2),Ne=ke[0],Ie=ke[1],Se=Object(l.useState)(0),ye=Object(c.a)(Se,2),Ce=ye[0],Ee=ye[1],Ae=Object(l.useState)(!1),Ue=Object(c.a)(Ae,2),Le=Ue[0],Fe=Ue[1],De=Object(S.b)(Object(o.a)(n.a.mark((function e(){var a,r,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ge&&fe.toLowerCase()!==N.a.currentUser.email.toLowerCase()){e.next=3;break}e.next=9;break;case 3:return e.next=5,k.c.auth.sendEmailVerificationCode({email:fe,type:"ChangeEmail",locale:N.a.locale},t("SendEmailVerifactionCode_ChangeEmail"));case 5:a=e.sent,r=a.requestError,c=a.response,r?I.a.error(r(s)):"DUPLICATE_EMAIL"===c.error?qe(!0):c.error?I.a.error(s("user_edit.errors.".concat(c.error),{errorMessage:c.errorMessage})):(I.a.success(s(".email.verification_code_sent")),Ee(61));case 9:case"end":return e.stop()}}),e)})))),ze=Object(c.a)(De,2),Pe=ze[0],Te=ze[1];Object(l.useEffect)((function(){var e=setInterval((function(){Ee((function(e){return e&&e-1}))}),1e3);return function(){return clearInterval(e)}}),[]);var We=Object(l.useState)(!1),Me=Object(c.a)(We,2),Ve=Me[0],qe=Me[1],Be=Object(S.b)(Object(o.a)(n.a.mark((function t(){var a,r,c;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ge&&fe.toLowerCase()!==N.a.currentUser.email.toLowerCase()){t.next=3;break}t.next=9;break;case 3:return t.next=5,k.c.user.updateUserSelfEmail({email:fe,emailVerificationCode:Ne});case 5:a=t.sent,r=a.requestError,c=a.response,r?I.a.error(r(s)):"DUPLICATE_EMAIL"===c.error?qe(!0):"INVALID_EMAIL_VERIFICATION_CODE"===c.error?Fe(!0):c.error?I.a.error(s("user_edit.errors.".concat(c.error))):(I.a.success(s(".email.success")),e.meta.id===N.a.currentUser.id&&(N.a.currentUser.email=fe),Ie(""),Fe(!1),Ee(0));case 9:case"end":return t.stop()}}),t)})))),Re=Object(c.a)(Be,2),He=Re[0],Je=Re[1],Ge=Object(l.useState)(new Date),Ke=Object(c.a)(Ge,2),Qe=Ke[0],Xe=Ke[1];Object(l.useEffect)((function(){var e=setInterval((function(){return Xe(new Date)}),6e4);return function(){return clearInterval(e)}}),[]);var Ye=Object(l.useState)(e.sessions),Ze=Object(c.a)(Ye,2),$e=Ze[0],es=Ze[1],ss=Object(l.useState)(!1),ts=Object(c.a)(ss,2),as=ts[0],rs=ts[1],ns=Object(S.b)(function(){var t=Object(o.a)(n.a.mark((function t(a){var r,c,o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k.c.auth.revokeUserSession({userId:e.meta.id,sessionId:a});case 2:r=t.sent,c=r.requestError,o=r.response,c?I.a.error(c(s)):o.error?I.a.error(s("user_edit.errors.".concat(o.error))):a?(I.a.success(s(".sessions.success_revoke")),es($e.filter((function(e){return e.sessionId!==a})))):(e.meta.id===N.a.currentUser.id?I.a.success(s(".sessions.success_revoke_all_current_user")):I.a.success(s(".sessions.success_revoke_all")),es($e.filter((function(s){return s.sessionId===e.currentSessionId})))),rs(!1);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),cs=Object(c.a)(ns,2)[1];return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("form",{children:[Object(i.jsx)(u.a,{className:_.a.sectionHeader,size:"large",content:s(".password.header")}),Object(i.jsx)("input",{readOnly:!0,type:"text",hidden:!0,autoComplete:"username",value:e.meta.username}),!a&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(u.a,{className:_.a.header,size:"tiny",content:s(".password.old")}),Object(i.jsx)(j.a,{className:_.a.notFullWidth,fluid:!0,value:g,type:"password",autoComplete:"current-password",onChange:function(e,s){var t=s.value;return!be&&(C(t),se(!1))},onBlur:ue,error:B||ee}),Object(i.jsx)("div",{className:_.a.notes,children:ee?s(".password.wrong_old_password"):B&&s(".password.invalid_password")})]}),Object(i.jsx)(u.a,{className:_.a.header,size:"tiny",content:s(".password.new")}),Object(i.jsx)(j.a,{className:_.a.notFullWidth,fluid:!0,value:F,type:"password",autoComplete:"new-password",onChange:function(e,s){var t=s.value;return!be&&(D(t),ne(!1))},onBlur:ue,error:G||re}),Object(i.jsx)("div",{className:_.a.notes,children:re?s(".password.empty_new_password"):G&&s(".password.invalid_password")}),Object(i.jsx)(u.a,{className:_.a.header,size:"tiny",content:s(".password.retype")}),Object(i.jsx)(j.a,{className:_.a.notFullWidth,fluid:!0,value:T,type:"password",autoComplete:"new-password",onChange:function(e,s){var t=s.value;return!be&&(W(t),le(!1))},onBlur:ue,error:Y||ie}),Object(i.jsx)("div",{className:_.a.notes,children:ie?s(".password.empty_retype_password"):Y&&s(".password.passwords_do_not_match")})]}),Object(i.jsx)(d.a,{className:_.a.submit,loading:be,primary:!0,content:s(".password.submit"),onClick:me}),e.meta.id===N.a.currentUser.id&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(u.a,{className:_.a.sectionHeader,size:"large",content:s(".email.header")}),Object(i.jsx)(u.a,{className:_.a.header,size:"tiny",content:s(".email.email")}),Object(i.jsx)(j.a,{className:_.a.notFullWidth,fluid:!0,value:fe,onChange:function(e,s){var t=s.value;return!He&&(ve(t),qe(!1))},onBlur:we,error:ge||Ve}),Object(i.jsx)("div",{className:_.a.notes,children:ge?s(".email.invalid_email"):Ve&&s(".email.duplicate_email")}),N.a.serverPreference.security.requireEmailVerification&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(u.a,{className:_.a.header,size:"tiny",content:s(".email.email_verification_code")}),Object(i.jsx)(j.a,{className:_.a.notFullWidth,fluid:!0,value:Ne,onChange:function(e,s){var t,a=s.value;return!He&&(t=a,Fe(!1),void Ie(Object(y.g)(t)))},error:Le,action:Object(i.jsx)(d.a,{disabled:0!==Ce,loading:Pe,content:Ce?"".concat(Ce>60?60:Ce,"s"):s(".email.send_email_verification_code"),onClick:Te})}),Object(i.jsx)("div",{className:_.a.notes,children:Le&&s(".email.invalid_email_verification_code")})]}),Object(i.jsx)(d.a,{className:_.a.submit,loading:He,primary:!0,content:s(".email.submit"),onClick:Je})]}),Object(i.jsx)(u.a,{className:_.a.sectionHeader+" "+_.a.bottomAttached,size:"large",content:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("span",{className:_.a.text,children:s(".sessions.header")}),$e.some((function(s){return s.sessionId!==e.currentSessionId}))&&Object(i.jsx)(b.a,{trigger:Object(i.jsx)(d.a,{basic:!0,negative:!0,className:_.a.revokeAll,content:s(".sessions.revoke_all")}),content:Object(i.jsx)(d.a,{content:s(".sessions.confirm_revoke_all"),negative:!0,onClick:function(){return cs()}}),open:as,onOpen:function(){return rs(!0)},onClose:function(){return rs(!1)},on:"click",position:"top center"})]})}),$e.length?Object(i.jsx)(m.a,{className:_.a.sessionList,children:$e.sort((function(e,s){return s.lastAccessTime-e.lastAccessTime})).map((function(t){var a=t.sessionId===e.currentSessionId,r=new h.UAParser(t.userAgent).getResult(),n=function(){var e={console:"terminal",mobile:"mobile alternate",wearable:"mobile alternate",embedded:"mobile alternate",tablet:"tablet alternate",smarttv:"desktop"},s={Windows:"windows","Mac OS":"apple",Ubuntu:"ubuntu",CentOS:"centos",SUSE:"suse",Fedora:"fedora"};return r.device.type in e?e[r.device.type]:r.os.name in s?s[r.os.name]:/BSD/.test(r.os.name)?"freebsd":/linux/i.test(r.ua)?"linux":"desktop"}(),c=r.os.name?r.os.name+(r.os.version?" "+r.os.version:""):"",o=r.browser.name?r.browser.name+(r.browser.version?" "+r.browser.version:""):"";return Object(i.jsxs)(O.a,{className:_.a.sessionListItem,children:[Object(i.jsx)(p.a,{className:_.a.light,size:"small",empty:!0,circular:!0,color:a?"green":"grey"}),Object(i.jsx)("div",{className:_.a.iconWrapper,children:Object(i.jsx)(f.a,{name:n})}),Object(i.jsxs)("div",{className:_.a.info,children:[Object(i.jsx)("div",{className:_.a.browserAndOs,title:t.userAgent,children:c||o?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("span",{className:_.a.os,children:c}),Object(i.jsx)("span",{className:_.a.browser,children:o})]}):s(".sessions.unknown_os_browser")}),Object(i.jsx)("div",{className:_.a.lastActive,children:a?s(".sessions.current"):Object(i.jsx)("span",{title:Object(A.a)(t.lastAccessTime)[1],children:Object(E.a)(s(".sessions.last_active",{time:w.a(t.lastAccessTime,N.a.locale,{relativeDate:Qe})}))})}),Object(i.jsxs)("div",{className:_.a.loginIpLocationTime,children:[Object(i.jsx)("span",{className:_.a.loginIpLocation,children:Object(E.a)(s(t.loginIpLocation?".sessions.login_ip_location":".sessions.login_ip",{ip:t.loginIp,location:t.loginIpLocation}))}),Object(i.jsx)("span",{className:_.a.time,title:Object(A.a)(t.loginTime)[1],children:w.a(t.loginTime,N.a.locale,{relativeDate:Qe})})]})]}),e.currentSessionId!==t.sessionId&&Object(i.jsx)(b.a,{trigger:Object(i.jsx)(d.a,{content:s(".sessions.revoke")}),content:Object(i.jsx)(d.a,{negative:!0,content:s(".sessions.confirm_revoke"),onClick:function(){return cs(t.sessionId)}}),on:"click",position:"left center"})]},t.sessionId)}))}):Object(i.jsx)(O.a,{placeholder:!0,children:Object(i.jsx)(u.a,{icon:!0,children:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(f.a,{name:"search"}),s(".sessions.no_sessions")]})})}),e.meta.id===N.a.currentUser.id&&Object(i.jsx)("div",{className:_.a.notes,children:s(".sessions.notes_current_user")})]})}))}}]);
//# sourceMappingURL=170.344cacb3.chunk.js.map