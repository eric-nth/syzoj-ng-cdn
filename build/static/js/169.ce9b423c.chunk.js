(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[169],{1666:function(e,a,t){"use strict";t.r(a),t.d(a,"fetchData",(function(){return R})),t.d(a,"View",(function(){return H}));var r,n=t(10),c=t.n(n),s=t(19),i=t(15),o=t(1),l=t(0),u=t(1803),j=t(593),b=t(1725),h=t(1807),d=t(1792),O=t(1728),m=t(99),f=t(618),v=t(1796),x=t(1726),g=t(55),p=t(1734),k=t(1667),_=t.n(k),N=t(738),y=t.n(N),q=t(181),w=t(9),C=t(182),z=t(22),S=t(733),U=t(183),G=t(689),I=t(37),Q=t(686);function R(e){return E.apply(this,arguments)}function E(){return(E=Object(i.a)(c.a.mark((function e(a){var t,r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.c.user.getUserProfile({username:a});case 2:if(t=e.sent,r=t.requestError,n=t.response,!r){e.next=9;break}throw new U.a(r,{showRefresh:!0,showBack:!0});case 9:if(!n.error){e.next=11;break}throw new U.a(Object(I.c)("user_edit.errors.".concat(n.error)));case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.Gravatar="gravatar",e.GitHub="github",e.QQ="qq"}(r||(r={}));var H=Object(g.a)((function(e){var a=Object(z.i)("user_edit.profile"),t=Object(l.useState)(e.meta.username),n=Object(s.a)(t,2),g=n[0],k=n[1];Object(l.useEffect)((function(){w.a.enterNewPage("".concat(a(".title")," - ").concat(g),null,!1)}),[w.a.locale,g]);var N=Object(z.d)(),U=Object(s.a)(N,2),I=(U[0],U[1]),R=Object(l.useState)(e.meta.username),E=Object(s.a)(R,2),H=E[0],P=E[1],A=Object(l.useState)(e.meta.email),B=Object(s.a)(A,2),V=B[0],J=B[1],L=Object(l.useState)(e.publicEmail),M=Object(s.a)(L,2),D=M[0],K=M[1],F=Object(l.useState)(e.meta.nickname),T=Object(s.a)(F,2),W=T[0],X=T[1],Y=Object(l.useState)(e.meta.bio),Z=Object(s.a)(Y,2),$=Z[0],ee=Z[1],ae=Object(l.useState)(e.information.organization),te=Object(s.a)(ae,2),re=te[0],ne=te[1],ce=Object(l.useState)(e.information.location),se=Object(s.a)(ce,2),ie=se[0],oe=se[1],le=Object(l.useState)(e.information.url),ue=Object(s.a)(le,2),je=ue[0],be=ue[1],he=Object(l.useState)(e.information.telegram),de=Object(s.a)(he,2),Oe=de[0],me=de[1],fe=Object(l.useState)(e.information.qq),ve=Object(s.a)(fe,2),xe=ve[0],ge=ve[1],pe=Object(l.useState)(e.information.github),ke=Object(s.a)(pe,2),_e=ke[0],Ne=ke[1],ye=Object(l.useRef)(),qe=Object(l.useRef)(),we=Object(l.useRef)(),Ce=Object(z.g)(je,(function(e){return!e||Object(p.a)(e)})),ze=Object(s.a)(Ce,2),Se=ze[0],Ue=ze[1],Ge=e.avatarInfo.substr(0,e.avatarInfo.indexOf(":")),Ie=Object(l.useState)(Object.values(r).includes(Ge)?Ge:r.Gravatar),Qe=Object(s.a)(Ie,2),Re=Qe[0],Ee=Qe[1],He=Object(l.useState)(e.avatarInfo.slice(e.avatarInfo.indexOf(":")+1)),Pe=Object(s.a)(He,2),Ae=Pe[0],Be=Pe[1],Ve=Object(l.useState)(Ae),Je=Object(s.a)(Ve,2),Le=Je[0],Me=Je[1];function De(e){switch(Ee(e),e){case r.Gravatar:Ke("");break;case r.GitHub:Ke(_e);break;case r.QQ:Ke(xe)}}function Ke(e){e!==Ae&&(Be(e),Me(e),Ze(!1))}function Fe(){Le!==Ae&&(Be(Le),Ze(!1))}var Te=function(){switch(Re){case r.GitHub:case r.QQ:return{type:Re,key:Ae};case r.Gravatar:default:return{type:r.Gravatar,key:_()((Ae||V).trim().toLowerCase())}}}(),We=Object(l.useState)(!1),Xe=Object(s.a)(We,2),Ye=Xe[0],Ze=Xe[1],$e=Object(z.b)(Object(i.a)(c.a.mark((function t(){var r,n,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Object(Q.f)(H)){t.next=5;break}C.a.error(a(".error_invalid_username")),ye.current.focus(),t.next=21;break;case 5:if(Object(Q.b)(V)){t.next=10;break}C.a.error(a(".error_invalid_email")),qe.current.focus(),t.next=21;break;case 10:if(!Ue){t.next=15;break}C.a.error(a(".error_invalid_url")),we.current.focus(),t.next=21;break;case 15:return t.next=17,q.c.user.updateUserProfile({userId:e.meta.id,username:H,email:V,publicEmail:D,avatarInfo:Re+":"+Le,nickname:W,bio:$,information:{organization:re,location:ie,url:je,telegram:Oe,qq:xe,github:_e}});case 17:r=t.sent,n=r.requestError,s=r.response,n?C.a.error(n(a)):s.error?C.a.error(a("user_edit.errors.".concat(s.error))):(I(!1),C.a.success(a("user_edit.preference.success")),k(H),w.a.currentUser.id===e.meta.id&&(w.a.currentUser.username=H,w.a.currentUser.email=V,w.a.currentUser.bio=$),H!==e.meta.username&&e.onChangeUsername(H));case 21:case"end":return t.stop()}}),t)})))),ea=Object(s.a)($e,2),aa=ea[0],ta=ea[1],ra=w.a.currentUser.isAdmin||w.a.currentUserPrivileges.includes("ManageUser"),na=w.a.serverPreference.security.allowUserChangeUsername;return Object(o.jsxs)("div",{className:y.a.profileContainer,children:[Object(o.jsxs)("div",{className:y.a.profileMain,children:[Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".username")}),Object(o.jsx)(j.a,{innerRef:ye,children:Object(o.jsx)(b.a,{readOnly:!(ra||na),fluid:!0,value:H,onChange:function(e,a){var t=a.value;return!aa&&t.length<24&&(I(!0),P(t))}})}),!(na&&e.meta.id===w.a.currentUser.id)&&Object(o.jsx)("div",{className:y.a.notes,children:a(ra?".username_notes_admin":".username_notes")}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".email")}),Object(o.jsx)(j.a,{innerRef:qe,children:Object(o.jsx)(b.a,{readOnly:!ra,fluid:!0,value:V,onChange:function(e,a){var t=a.value;return!aa&&(I(!0),J(t))}})}),Object(o.jsx)(h.a,{className:y.a.checkbox,checked:D,label:a(".public_email"),onChange:function(e,a){var t=a.checked;return!aa&&(I(!0),K(t))}}),Object(o.jsx)("div",{className:y.a.notes,children:a(ra?".email_notes_admin":".email_notes")}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".nickname")}),Object(o.jsx)(b.a,{fluid:!0,value:W,onChange:function(e,a){var t=a.value;return!aa&&t.length<24&&(I(!0),X(t))}}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".bio")}),Object(o.jsx)(d.a,{children:Object(o.jsx)(O.a,{className:y.a.textarea,placeholder:a(".bio_placeholder"),value:$,onChange:function(e,a){var t=a.value;return t.length<=160&&!aa&&(I(!0),ee(t))}})}),$.length>=150&&Object(o.jsxs)("div",{className:y.a.notes,children:[$.length,"/160"]}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".organization")}),Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".organization_placeholder"),value:re,onChange:function(e,a){var t=a.value;return t.length<80&&!aa&&(I(!0),ne(t))}}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".location")}),Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".location_placeholder"),value:ie,onChange:function(e,a){var t=a.value;return t.length<80&&!aa&&(I(!0),oe(t))}}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".url")}),Object(o.jsx)(j.a,{innerRef:we,children:Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".url_placeholder"),value:je,error:Ue,onBlur:Se,onChange:function(e,a){var t=a.value;return t.length<80&&!aa&&(I(!0),be(t.trim()))}})}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".qq")}),Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".qq_placeholder"),value:xe,onChange:function(e,a){var t=a.value;return t.length<30&&!aa&&(I(!0),ge(t.trim()))}}),xe&&Object(o.jsxs)("div",{className:y.a.notes,children:[Object(o.jsx)(m.a,{name:"qq"}),a(".qq_notes"),Object(o.jsxs)("a",{href:"https://wpa.qq.com/msgrd?V=3&Uin=".concat(xe),target:"_blank",rel:"noreferrer noopener",children:["https://wpa.qq.com/msgrd?V=3&Uin=",xe]})]}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".telegram")}),Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".telegram_placeholder"),value:Oe,onChange:function(e,a){var t=a.value;return t.length<30&&!aa&&(I(!0),me(t.trim()))}}),Oe&&Object(o.jsxs)("div",{className:y.a.notes,children:[Object(o.jsx)(m.a,{name:"telegram"}),a(".telegram_notes"),Object(o.jsxs)("a",{href:"https://t.me/".concat(Oe),target:"_blank",rel:"noreferrer noopener",children:["https://t.me/",Oe]})]}),Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".github")}),Object(o.jsx)(b.a,{fluid:!0,placeholder:a(".github_placeholder"),value:_e,onChange:function(e,a){var t=a.value;return t.length<30&&!aa&&(I(!0),Ne(t.trim()))}}),_e&&Object(o.jsxs)("div",{className:y.a.notes,children:[Object(o.jsx)(m.a,{name:"github"}),a(".github_notes"),Object(o.jsxs)("a",{href:"https://github.com/".concat(_e),target:"_blank",rel:"noreferrer noopener",children:["https://github.com/",_e]})]}),Object(o.jsx)(f.a,{className:y.a.submit,loading:aa,primary:!0,content:a(".submit"),onClick:ta})]}),Object(o.jsxs)("div",{className:y.a.profileAvatar,children:[Object(o.jsx)(u.a,{className:y.a.header,size:"tiny",content:a(".avatar.header")}),Object(o.jsx)(S.a,{userAvatar:Te,placeholder:!Te.key,imageSize:480,className:y.a.avatar,onError:function(){return Ze(!0)}}),Object(o.jsxs)(v.a,{className:y.a.avatarOptionList,children:[Object(o.jsx)(v.a.Item,{children:Object(o.jsx)(x.a,{checked:Re===r.Gravatar,onChange:function(e,a){return a.checked&&(I(!0),De(r.Gravatar))},label:a(".avatar.gravatar.name")})}),Object(o.jsx)(v.a.Item,{children:Object(o.jsx)(x.a,{checked:Re===r.QQ,onChange:function(e,a){return a.checked&&(I(!0),De(r.QQ))},label:a(".avatar.qq.name")})}),Object(o.jsx)(v.a.Item,{children:Object(o.jsx)(x.a,{checked:Re===r.GitHub,onChange:function(e,a){return a.checked&&(I(!0),De(r.GitHub))},label:a(".avatar.github.name")})})]}),Object(o.jsx)(b.a,{className:y.a.avatarInput,fluid:!0,placeholder:Re===r.Gravatar?V:Re===r.GitHub?a(".avatar.github.placeholder"):a(".avatar.qq.placeholder"),error:Ye,value:Le,onChange:function(e,a){var t=a.value;return t.length<=40&&(I(!0),Me(t.trim()))},onBlur:Fe,onKeyPress:Object(G.a)((function(){return Fe()}))}),Ye&&Object(o.jsxs)("div",{className:y.a.notes,children:[Object(o.jsx)(m.a,{name:"warning sign"}),a(".avatar.error")]})]})]})}))}}]);
//# sourceMappingURL=169.ce9b423c.chunk.js.map