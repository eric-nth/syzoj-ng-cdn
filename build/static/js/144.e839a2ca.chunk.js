(self["webpackJsonpsyzoj-ng-app"]=self["webpackJsonpsyzoj-ng-app"]||[]).push([[144],{1341:function(e,r,t){"use strict";t.r(r);var n=t(29),a=t(10),c=t.n(a),s=t(80),o=t(15),u=t(19),i=t(1),l=t(0),b=t(1803),j=t(1725),p=t(618),O=t(1792),f=t(602),m=t(593),d=t(99),g=t(617),x=t(14),h=t(39),k=t(55),w=t(843),y=t.n(w),_=t(9),v=t(181),E=t(22),S=t(686),C=t(182),R=t(185),U=t(755),N=t(689),P=t(1730),q=function(){var e=Object(E.i)("login"),r=Object(h.e)(),t=Object(E.k)(),a=function(){t.navigate(r.url.query.loginRedirectUrl||"/")},x=Object(E.j)();Object(l.useEffect)((function(){_.a.currentUser&&a()}),[]),Object(l.useEffect)((function(){_.a.enterNewPage(e(".title"))}),[_.a.locale]);var k=Object(E.l)(),w=Object(l.useState)({type:null,message:null}),q=Object(u.a)(w,2),T=q[0],F=q[1],M=function(e,r){return F({type:e,message:r})},z=Object(l.useState)(null),A=Object(u.a)(z,2),I=A[0],L=A[1],D=function(e){M(null,null),L(e)},G=Object(l.useState)(""),H=Object(u.a)(G,2),J=H[0],W=H[1],B=Object(l.useState)(""),K=Object(u.a)(B,2),Q=K[0],V=K[1],X=Object(l.useState)(!1),Y=Object(u.a)(X,2),Z=Y[0],$=Y[1],ee=Object(l.useRef)(),re=Object(l.useRef)(),te=Object(l.useState)(""),ne=Object(u.a)(te,2),ae=ne[0],ce=ne[1],se=Object(l.useRef)(),oe=Object(E.b)(Object(o.a)(c.a.mark((function r(){var t,n,a,o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Object(S.f)(ae)){r.next=3;break}return C.a.error(e(".migration.invalid_username")),r.abrupt("return");case 3:return r.next=5,v.c.migration.migrateUser((t={},Object(s.a)(t,Object(P.a)(J)?"email":"oldUsername",J),Object(s.a)(t,"oldPassword",Q),Object(s.a)(t,"newUsername",ae),Object(s.a)(t,"newPassword",Q),t));case 5:n=r.sent,a=n.requestError,o=n.response,a?C.a.error(a(e)):o.error?je(o.error):(se.current=ae,W(ae),pe.current(o.token));case 9:case"end":return r.stop()}}),r)})))),ue=Object(u.a)(oe,2),ie=ue[0],le=ue[1],be=Object(E.e)({size:"small"},Object(i.jsx)(b.a,{icon:"key",content:e(".migration.title")}),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("p",{children:e(".migration.message")}),Object(i.jsx)("p",{dangerouslySetInnerHTML:{__html:e(".migration.message_username")}}),Object(i.jsx)(j.a,{icon:"user",iconPosition:"left",placeholder:e(".migration.placeholder"),value:ae,readOnly:ie,onChange:function(e,r){var t=r.value;return ce(t)}})]}),(function(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(p.a,{disabled:ie,content:e(".migration.cancel"),onClick:function(){ce(""),pe.current()}}),Object(i.jsx)(p.a,{primary:!0,loading:ie,content:e(".migration.confirm"),onClick:function(){return le()}})]})}));function je(r){switch(r){case"NO_SUCH_USER":M("usernameOrEmail",e(".no_such_user")),ee.current.focus(),ee.current.select();break;case"WRONG_PASSWORD":M("password",e(".wrong_password")),re.current.focus(),re.current.select();break;default:C.a.error(e(".errors.".concat(r)))}}var pe=Object(l.useRef)();function Oe(){return fe.apply(this,arguments)}function fe(){return(fe=Object(o.a)(c.a.mark((function e(){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be.open(),e.next=3,new Promise((function(e){return pe.current=e}));case 3:return r=e.sent,be.close(),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return de.apply(this,arguments)}function de(){return(de=Object(o.a)(c.a.mark((function r(){var t,n,a,o,u,i,l;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,v.c.migration.queryUserMigrationInfo(Object(s.a)({},Object(P.a)(J)?"email":"oldUsername",J));case 2:if(t=r.sent,n=t.requestError,a=t.response,!n){r.next=9;break}C.a.error(n(e)),r.next=34;break;case 9:if(!a.error){r.next=13;break}je(a.error),r.next=34;break;case 13:if(!a.migrated){r.next=16;break}return C.a.error(e(".system_error")),r.abrupt("return");case 16:if(!a.usernameMustChange){r.next=20;break}return r.next=19,Oe();case 19:return r.abrupt("return",r.sent);case 20:return r.next=22,v.c.migration.migrateUser((o={},Object(s.a)(o,Object(P.a)(J)?"email":"oldUsername",J),Object(s.a)(o,"oldPassword",Q),Object(s.a)(o,"newPassword",Q),o));case 22:if(u=r.sent,i=u.requestError,l=u.response,!i){r.next=29;break}C.a.error(i(e)),r.next=34;break;case 29:if(!l.error){r.next=33;break}je(l.error),r.next=34;break;case 33:return r.abrupt("return",l.token);case 34:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function ge(){return(ge=Object(o.a)(c.a.mark((function r(){var t,n,u,i,l;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Z){r.next=2;break}return r.abrupt("return");case 2:if($(!0),0!==J.length){r.next=7;break}M("usernameOrEmail",e(".empty_username_or_email")),r.next=40;break;case 7:if(!(J.length>80)||Object(P.a)(J)){r.next=11;break}M("usernameOrEmail",e(".invalid_username_or_email")),r.next=40;break;case 11:if(0!==Q.length){r.next=15;break}M("password",e(".empty_password")),r.next=40;break;case 15:return r.next=17,v.c.auth.login((t={},Object(s.a)(t,Object(P.a)(J)?"email":"username",J),Object(s.a)(t,"password",Q),t),k("Login"));case 17:if(n=r.sent,u=n.requestError,i=n.response,!u){r.next=24;break}C.a.error(u(e)),r.next=40;break;case 24:if(!i.error||"USER_NOT_MIGRATED"===i.error){r.next=28;break}je(i.error),r.next=40;break;case 28:if(M(null,null),l="",i.error||(l=i.token),"USER_NOT_MIGRATED"!==i.error){r.next=35;break}return r.next=34,me();case 34:l=r.sent;case 35:if(!l){r.next=40;break}return _.a.token=l,D(e(".welcome",{username:se.current||i.username})),setTimeout(Object(o.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(R.b)();case 2:a();case 3:case"end":return e.stop()}}),e)}))),1e3),r.abrupt("return");case 40:$(!1);case 41:case"end":return r.stop()}}),r)})))).apply(this,arguments)}var xe=_.a.appLogoThemed&&Object(i.jsx)("img",Object(n.a)({className:y.a.logo},_.a.appLogoThemed));return Object(i.jsxs)(i.Fragment,{children:[be.element,Object(i.jsxs)("div",{className:y.a.wrapper,children:[Object(i.jsxs)(b.a,{as:"h2",className:y.a.header+(xe?" "+y.a.withLogo:""),textAlign:"center",children:[xe,e(".login_to_your_account")]}),Object(i.jsx)(O.a,{size:"large",children:Object(i.jsxs)(f.a,{children:[Object(i.jsx)(m.a,{innerRef:function(e){return e&&(ee.current=e.querySelector("input"))},children:Object(i.jsx)(O.a.Field,{control:j.a,error:"usernameOrEmail"===T.type&&{content:T.message,pointing:"left"},fluid:!0,icon:"user",iconPosition:"left",placeholder:e(".username_or_email"),value:J,autoComplete:"username",readOnly:Z,onChange:function(e){return W(e.target.value)},onKeyPress:Object(N.a)((function(){return re.current.focus()}))})}),Object(i.jsx)(U.a,{onClick:function(){return x("forgot")},tabIndex:-1,className:y.a.inputAction,children:e(".forgot_password")}),Object(i.jsx)(m.a,{innerRef:function(e){return e&&(re.current=e.querySelector("input"))},children:Object(i.jsx)(O.a.Field,{control:j.a,error:"password"===T.type&&{content:T.message,pointing:"left"},fluid:!0,icon:"lock",iconPosition:"left",placeholder:e(".password"),value:Q,type:"password",autoComplete:"current-password",readOnly:Z,onChange:function(e){return V(e.target.value)}})}),k.getCopyrightMessage(y.a.recaptchaCopyright),Object(i.jsx)(p.a,{className:I&&y.a.successButton,primary:!I,color:I?"green":null,fluid:!0,size:"large",loading:Z&&!I,onClick:function(){return function(){return ge.apply(this,arguments)}()},children:I?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(d.a,{name:"checkmark"}),I]}):e(".login")})]})}),Object(i.jsxs)(g.a,{className:y.a.message,children:[e(".new_user"),Object(i.jsx)(U.a,{onClick:function(){return x("register")},children:e(".register")})]})]})]})};q=Object(k.a)(q),r.default=Object(x.j)({view:Object(i.jsx)(q,{})})}}]);
//# sourceMappingURL=144.e839a2ca.chunk.js.map